import asyncio
import json
import os
import random
import asyncio
import subprocess
import logging
import datetime
from telegram.ext import JobQueue
from pathlib import Path
from telegram.ext import filters
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, ReplyKeyboardMarkup
from telegram.ext import (
    Application, filters, CommandHandler, CallbackQueryHandler, ContextTypes, CallbackContext, MessageHandler
)
from apscheduler.schedulers.asyncio import AsyncIOScheduler
import asyncio
import nest_asyncio

# Ñ‚Ð¾ÐºÐµÐ½
TOKEN = "7620764762:AAEcapfLboAOgmy7OBCShxUc84OSRFg3KDg"

# Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð°
TEST_DESCRIPTION = (
    "Ð­Ñ‚Ð¾Ñ‚ Ñ‚ÐµÑÑ‚ Ð¿Ð¾Ð¼Ð¾Ð³Ð°ÐµÑ‚ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ Ð² ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ðµ Ð»Ð¸Ñ‡Ð½Ð¾ÑÑ‚Ð¸.\n\n"
    "Ð¢Ñ€ÐµÐ²Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ ÐºÐ°Ðº Ð»Ð¸Ñ‡Ð½Ð¾ÑÑ‚Ð½Ð°Ñ Ñ‡ÐµÑ€Ñ‚Ð° Ð¾Ð·Ð½Ð°Ñ‡Ð°ÐµÑ‚ Ð¼Ð¾Ñ‚Ð¸Ð² Ð¸Ð»Ð¸ Ð¿Ñ€Ð¸Ð¾Ð±Ñ€ÐµÑ‚ÐµÐ½Ð½ÑƒÑŽ Ð¿Ð¾Ð²ÐµÐ´ÐµÐ½Ñ‡ÐµÑÐºÑƒÑŽ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸ÑŽ, "
    "ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ð·Ð°ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÐ° Ð²Ð¾ÑÐ¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°Ñ‚ÑŒ ÑˆÐ¸Ñ€Ð¾ÐºÐ¸Ð¹ ÐºÑ€ÑƒÐ³ Ð¾Ð±ÑŠÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ñ‹Ñ… Ð¾Ð±ÑÑ‚Ð¾ÑÑ‚ÐµÐ»ÑŒÑÑ‚Ð² "
    "ÐºÐ°Ðº ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ñ… ÑƒÐ³Ñ€Ð¾Ð·Ñƒ, Ð¿Ð¾Ð±ÑƒÐ¶Ð´Ð°Ñ Ñ€ÐµÐ°Ð³Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð½Ð° Ð½Ð¸Ñ… ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸ÑÐ¼Ð¸ Ñ‚Ñ€ÐµÐ²Ð¾Ð³Ð¸.\n\n"
    "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ:"
)
# Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸ÑŽ
EMOTION_ADVICE = {
    "Ð¡Ñ‚Ñ€ÐµÑÑ": [
        (
            "ðŸ”„ ÐšÐ²Ð°Ð´Ñ€Ð°Ñ‚Ð½Ð¾Ðµ Ð´Ñ‹Ñ…Ð°Ð½Ð¸Ðµ\n\n"
            "Ð˜Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ñ:\n"
            "- Ð’Ð´Ð¾Ñ… Ñ‡ÐµÑ€ÐµÐ· Ð½Ð¾Ñ (4 ÑÐµÐº)\n"
            "- Ð—Ð°Ð´ÐµÑ€Ð¶ÐºÐ° (4 ÑÐµÐº)\n"
            "- Ð’Ñ‹Ð´Ð¾Ñ… Ñ‡ÐµÑ€ÐµÐ· Ñ€Ð¾Ñ‚ (4 ÑÐµÐº)\n"
            "- ÐŸÐ°ÑƒÐ·Ð° (4 ÑÐµÐº)\n\n"
            "ðŸ” Ð¦Ð¸ÐºÐ»: 5-10 Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð¾Ð²\n"
            "ðŸ’« Ð­Ñ„Ñ„ÐµÐºÑ‚: Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð¸Ñ€ÑƒÐµÑ‚ ÑÐµÑ€Ð´Ñ†Ðµ Ð¸ Ð¼Ð¾Ð·Ð³"
        ),
        (
            "ðŸš¶ ÐÐ½Ñ‚Ð¸ÑÑ‚Ñ€ÐµÑÑ-Ð¿Ñ€Ð¾Ð³ÑƒÐ»ÐºÐ°\n\n"
            "Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸:\n"
            "- Ð˜Ð´Ð¸Ñ‚Ðµ Ð² ÑÐ¿Ð¾ÐºÐ¾Ð¹Ð½Ð¾Ð¼ Ñ‚ÐµÐ¼Ð¿Ðµ\n"
            "- ÐžÑ‚Ð¼ÐµÑ‡Ð°Ð¹Ñ‚Ðµ Ð´ÐµÑ‚Ð°Ð»Ð¸ Ð²Ð¾ÐºÑ€ÑƒÐ³ (Ð´ÐµÑ€ÐµÐ²ÑŒÑ, Ð¾Ð±Ð»Ð°ÐºÐ°)\n"
            "- ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½ Ð½Ð° 10 Ð¼Ð¸Ð½\n\n"
            "ðŸŒ¿ Ð­Ñ„Ñ„ÐµÐºÑ‚: ÐŸÐ¾Ð²Ñ‹ÑˆÐ°ÐµÑ‚ Ð¾ÐºÑÐ¸Ñ‚Ð¾Ñ†Ð¸Ð½"
        )
    ],
    "Ð¢Ñ€ÐµÐ²Ð¾Ð³Ð°": [
        (
            "ðŸŒ€ Ð”Ñ‹Ñ…Ð°Ð½Ð¸Ðµ 4-7-8\n\n"
            "Ð˜Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ñ:\n"
            "- Ð’Ð´Ð¾Ñ… Ñ‡ÐµÑ€ÐµÐ· Ð½Ð¾Ñ (4 ÑÐµÐº)\n"
            "- Ð—Ð°Ð´ÐµÑ€Ð¶ÐºÐ° Ð´Ñ‹Ñ…Ð°Ð½Ð¸Ñ (7 ÑÐµÐº)\n"
            "- Ð’Ñ‹Ð´Ð¾Ñ… Ñ‡ÐµÑ€ÐµÐ· Ñ€Ð¾Ñ‚ (8 ÑÐµÐº)\n\n"
            "ðŸ’¨ ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚Ðµ 4 Ñ†Ð¸ÐºÐ»Ð°\n"
            "âœ¨ Ð­Ñ„Ñ„ÐµÐºÑ‚: Ð¡Ð½Ð¸Ð¶Ð°ÐµÑ‚ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð°Ð´Ñ€ÐµÐ½Ð°Ð»Ð¸Ð½Ð°\n"
            "Ð’Ð¾ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ÑÑ ÐºÐ½Ð¾Ð¿ÐºÐ¾Ð¹ Ð”Ñ‹Ñ…Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð´ÐµÐ»Ð°Ñ‚ÑŒ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ñ Ð²Ð¼ÐµÑÑ‚Ðµ!"
        ),
        (
            "ðŸ“¿ ÐœÐµÐ´Ð¸Ñ‚Ð°Ñ†Ð¸Ñ Ð½Ð° Ð´Ñ‹Ñ…Ð°Ð½Ð¸Ð¸\n\n"
            "ÐšÐ°Ðº Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑ‚ÑŒ:\n"
            "- Ð¡ÑÐ´ÑŒÑ‚Ðµ ÑƒÐ´Ð¾Ð±Ð½Ð¾, Ð·Ð°ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð³Ð»Ð°Ð·Ð°\n"
            "- Ð¡Ð¾ÑÑ€ÐµÐ´Ð¾Ñ‚Ð¾Ñ‡ÑŒÑ‚ÐµÑÑŒ Ð½Ð° Ð²Ð´Ð¾Ñ…Ð°Ñ…/Ð²Ñ‹Ð´Ð¾Ñ…Ð°Ñ…\n"
            "- Ð¡Ñ‡Ð¸Ñ‚Ð°Ð¹Ñ‚Ðµ: Â«Ð’Ð´Ð¾Ñ…-1, Ð²Ñ‹Ð´Ð¾Ñ…-2Â» (Ð´Ð¾ 10)\n\n"
            "â± Ð”Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ: 5-10 Ð¼Ð¸Ð½ÑƒÑ‚\n"
            "âœ¨ Ð­Ñ„Ñ„ÐµÐºÑ‚: Ð¡Ð½Ð¸Ð¶Ð°ÐµÑ‚ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ ÐºÐ¾Ñ€Ñ‚Ð¸Ð·Ð¾Ð»Ð°"
        )
    ],
    "Ð£ÑÑ‚Ð°Ð»Ð¾ÑÑ‚ÑŒ": [
        (
            "ðŸ’¤ Ð¢ÐµÑ…Ð½Ð¸ÐºÐ° Â«ÐšÐ¾Ñ„Ðµ-Ð½Ð°Ð¿Â»\n\n"
            "ÐšÐ°Ðº Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑ‚ÑŒ:\n"
            "- Ð’Ñ‹Ð¿ÐµÐ¹Ñ‚Ðµ Ñ‡Ð°ÑˆÐºÑƒ ÐºÐ¾Ñ„Ðµ (Ð±ÐµÐ· ÑÐ°Ñ…Ð°Ñ€Ð°)\n"
            "- Ð¡Ñ€Ð°Ð·Ñƒ Ð»ÑÐ³Ñ‚Ðµ Ð¿Ð¾ÑÐ¿Ð°Ñ‚ÑŒ Ð½Ð° 15-20 Ð¼Ð¸Ð½\n"
            "- ÐŸÑ€Ð¾ÑÐ½Ð¸Ñ‚ÐµÑÑŒ Ð´Ð¾ Ñ„Ð°Ð·Ñ‹ Ð³Ð»ÑƒÐ±Ð¾ÐºÐ¾Ð³Ð¾ ÑÐ½Ð°\n\n"
            "âš ï¸ ÐŸÑ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ðµ: ÐÐµ Ð¿Ð¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ Ð¿Ñ€Ð¸ Ð³Ð¸Ð¿ÐµÑ€Ñ‚Ð¾Ð½Ð¸Ð¸"
        ),
        (
            "ðŸŽ§ Ð—Ð²ÑƒÐºÐ¾Ð²Ð°Ñ Ñ‚ÐµÑ€Ð°Ð¿Ð¸Ñ\n\n"
            "ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ñ‚Ñ€ÐµÐºÐ¾Ð²:\n"
            "- Ð¨ÑƒÐ¼ Ð¿Ñ€Ð¸Ð±Ð¾Ñ (10-Ñ‡Ð°ÑÐ¾Ð²Ð¾Ð¹ loop)\n"
            "- ÐŸÐµÐ½Ð¸Ðµ ÐºÐ¸Ñ‚Ð¾Ð² (Calm, Headspace)\n\n"
            "ðŸ”Š ÐšÐ°Ðº Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ:\n"
            "- Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Ñ„Ð¾Ð½Ð¾Ð¼ Ð²Ð¾ Ð²Ñ€ÐµÐ¼Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹\n"
            "- Ð¡Ð»ÑƒÑˆÐ°Ð¹Ñ‚Ðµ Ð² Ð½Ð°ÑƒÑˆÐ½Ð¸ÐºÐ°Ñ… Ð´Ð»Ñ Ð¿Ð¾Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð¸Ñ\n"
            "â•Ð’Ð¾ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ÑÑ ÐºÐ½Ð¾Ð¿ÐºÐ¾Ð¹ Ð ÐµÐ»Ð°ÐºÑÐ°Ñ†Ð¸Ñ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑƒÐ¶Ðµ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ ÑÐ»ÑƒÑˆÐ°Ñ‚ÑŒ Ð¼ÑƒÐ·Ñ‹ÐºÑƒ Ð´Ð»Ñ Ñ€Ð°ÑÑÐ»Ð°Ð±Ð»ÐµÐ½Ð¸Ñ!"
        )
    ],
    "Ð“Ð½ÐµÐ²": [
        (
            "ðŸ’¥ Ð¢ÐµÑ…Ð½Ð¸ÐºÐ° Â«Ð‘ÑƒÐ¼Ð°Ð¶Ð½Ñ‹Ð¹ Ð³Ð½ÐµÐ²Â»\n\n"
            "Ð˜Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ñ:\n"
            "- Ð¡ÐºÐ¾Ð¼ÐºÐ°Ð¹Ñ‚Ðµ Ð»Ð¸ÑÑ‚ Ð±ÑƒÐ¼Ð°Ð³Ð¸\n"
            "- Ð Ð°Ð·Ð¾Ñ€Ð²Ð¸Ñ‚Ðµ ÐµÐ³Ð¾ Ð½Ð° Ð¼ÐµÐ»ÐºÐ¸Ðµ ÐºÑƒÑÐ¾Ñ‡ÐºÐ¸\n"
            "- Ð’Ñ‹Ð±Ñ€Ð¾ÑÑŒÑ‚Ðµ Ð² ÑƒÑ€Ð½Ñƒ Ñ Ð¼Ñ‹ÑÐ»ÑŒÑŽ: Â«Ð“Ð½ÐµÐ² ÑƒÑ…Ð¾Ð´Ð¸Ñ‚Â»\n\n"
            "ðŸ”¥ ÐÐ»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð°: ÐŸÐ¾Ð±Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´ÑƒÑˆÐºÑƒ"
        ),
        (
            "â„ï¸ Ð”Ñ‹Ñ…Ð°Ð½Ð¸Ðµ Â«ÐžÑ…Ð»Ð°Ð¶Ð´ÐµÐ½Ð¸ÐµÂ»\n\n"
            "ÐšÐ°Ðº Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑ‚ÑŒ:\n"
            "- Ð’Ð´Ð¾Ñ… Ñ‡ÐµÑ€ÐµÐ· Ð½Ð¾Ñ (3 ÑÐµÐº)\n"
            "- Ð’Ñ‹Ð´Ð¾Ñ… Ñ‡ÐµÑ€ÐµÐ· ÑÐ»Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ðµ Ñ‚Ñ€ÑƒÐ±Ð¾Ñ‡ÐºÐ¾Ð¹ Ð³ÑƒÐ±Ñ‹ (6 ÑÐµÐº)\n\n"
            "â± 10 Ñ†Ð¸ÐºÐ»Ð¾Ð² â†’ ÑÐ½Ð¸Ð¶Ð°ÐµÑ‚ Ð¸Ð¼Ð¿ÑƒÐ»ÑŒÑÐ¸Ð²Ð½Ð¾ÑÑ‚ÑŒ"
        )
    ],
    "ÐžÐ´Ð¸Ð½Ð¾Ñ‡ÐµÑÑ‚Ð²Ð¾": [
        (
            "ðŸ¤ Ð’Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ñ‡ÐµÐ»Ð»ÐµÐ½Ð´Ð¶\n\n"
            "Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ:\n"
            "- ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ 3 Ð»ÑŽÐ´ÑÐ¼ Ñ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ¾Ð¼ Â«ÐšÐ°Ðº Ñ‚Ð²Ð¾Ð¸ Ð´ÐµÐ»Ð°?Â»\n"
            "- ÐŸÑ€Ð¸Ð¼Ð¸Ñ‚Ðµ ÑƒÑ‡Ð°ÑÑ‚Ð¸Ðµ Ð² Ð¾Ð½Ð»Ð°Ð¹Ð½-Ð¸Ð²ÐµÐ½Ñ‚Ð°Ñ… (Ð²ÐµÐ±Ð¸Ð½Ð°Ñ€Ñ‹, Ð¸Ð³Ñ€Ñ‹)\n\n"
            "ðŸŒ ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹: Meetup, Discord-ÑÐ¾Ð¾Ð±Ñ‰ÐµÑÑ‚Ð²Ð°"
        ),
        (
            "ðŸ“ ÐŸÐ¸ÑÑŒÐ¼Ð¾ Ð±ÑƒÐ´ÑƒÑ‰ÐµÐ¼Ñƒ ÑÐµÐ±Ðµ\n\n"
            "Ð¨Ð°Ð±Ð»Ð¾Ð½:\n"
            "- Â«Ð§ÐµÑ€ÐµÐ· Ð³Ð¾Ð´ Ñ Ð±ÑƒÐ´Ñƒ...Â»\n"
            "- Â«Ð¡ÐµÐ¹Ñ‡Ð°Ñ Ð¼Ð½Ðµ Ð²Ð°Ð¶Ð½Ð¾ Ð¿Ð¾Ð¼Ð½Ð¸Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾...Â»\n\n"
            "âœ‰ï¸ ÐžÑ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ Ð¿Ð¸ÑÑŒÐ¼Ð¾ Ñ‡ÐµÑ€ÐµÐ· ÑÐµÑ€Ð²Ð¸Ñ FutureMe"
        )
    ],
    "ÐÐ¿Ð°Ñ‚Ð¸Ñ": [
        (
            "ðŸš€ ÐœÐ¸ÐºÑ€Ð¾Ñ†ÐµÐ»Ð¸\n\n"
            "ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹:\n"
            "- Ð¡Ð´ÐµÐ»Ð°Ñ‚ÑŒ 5-Ð¼Ð¸Ð½ÑƒÑ‚Ð½ÑƒÑŽ Ð·Ð°Ñ€ÑÐ´ÐºÑƒ\n"
            "- ÐŸÑ€Ð¸Ð³Ð¾Ñ‚Ð¾Ð²Ð¸Ñ‚ÑŒ Ñ‡Ð°Ð¹ Ñ Ð»ÑŽÐ±Ð¸Ð¼Ð¾Ð¹ Ð´Ð¾Ð±Ð°Ð²ÐºÐ¾Ð¹\n\n"
            "âœ… ÐšÐ°Ð¶Ð´Ð°Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð½Ð°Ñ Ð·Ð°Ð´Ð°Ñ‡Ð° â†’ ÑˆÐ°Ð³ Ðº Ð²Ñ‹Ñ…Ð¾Ð´Ñƒ Ð¸Ð· Ð°Ð¿Ð°Ñ‚Ð¸Ð¸"
        ),
        (
            "ðŸŽ­ Ð¢ÐµÑ…Ð½Ð¸ÐºÐ° Â«ÐÐºÑ‚Ñ‘Ñ€Â»\n\n"
            "Ð˜Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ñ:\n"
            "- ÐŸÑ€ÐµÐ´ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ, Ñ‡Ñ‚Ð¾ Ð²Ñ‹ Ð¸Ð³Ñ€Ð°ÐµÑ‚Ðµ ÑÐ½ÐµÑ€Ð³Ð¸Ñ‡Ð½Ð¾Ð³Ð¾ Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð¶Ð°\n"
            "- Ð”ÐµÐ¹ÑÑ‚Ð²ÑƒÐ¹Ñ‚Ðµ Â«ÐºÐ°Ðº Ð±ÑƒÐ´Ñ‚Ð¾Â» 15 Ð¼Ð¸Ð½ÑƒÑ‚\n\n"
            "ðŸŽ¯ Ð­Ñ„Ñ„ÐµÐºÑ‚: Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ Ð¾Ð±Ñ€Ð°Ñ‚Ð½ÑƒÑŽ ÑÐ²ÑÐ·ÑŒ Ð¼Ð¾Ð·Ð³-Ñ‚ÐµÐ»Ð¾"
        )
    ],
    "Ð Ð°Ð´Ð¾ÑÑ‚ÑŒ": [
        (
            "ðŸŽ‰ Ð¢ÐµÑ…Ð½Ð¸ÐºÐ° Â«ÐšÐ°Ð¿ÑÑƒÐ»Ð° ÑÑ‡Ð°ÑÑ‚ÑŒÑÂ»\n\n"
            "Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ:\n"
            "- Ð—Ð°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð½Ð° Ð±ÑƒÐ¼Ð°Ð³Ðµ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚, ÐºÐ¾Ð³Ð´Ð° Ð²Ñ‹ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¾Ð²Ð°Ð»Ð¸ Ñ€Ð°Ð´Ð¾ÑÑ‚ÑŒ\n"
            "- ÐŸÐ¾Ð»Ð¾Ð¶Ð¸Ñ‚Ðµ Ð² Ð±Ð°Ð½ÐºÑƒ Ð¸ Ð¿ÐµÑ€ÐµÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°Ð¹Ñ‚Ðµ Ð² Ñ‚Ñ€ÑƒÐ´Ð½Ñ‹Ðµ Ð´Ð½Ð¸\n\n"
            "ðŸ“¦ Ð­Ñ„Ñ„ÐµÐºÑ‚: Ð¡Ð¾Ð·Ð´Ð°ÐµÑ‚ Â«Ð±Ð°Ð½ÐºÂ» Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²Ð½Ñ‹Ñ… Ð²Ð¾ÑÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ð¹"
        ),
        (
            "ðŸŒž Ð Ð¸Ñ‚ÑƒÐ°Ð» Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ð½Ð¾ÑÑ‚Ð¸\n\n"
            "ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹:\n"
            "- ÐÐ°Ð·Ð¾Ð²Ð¸Ñ‚Ðµ 3 Ð²ÐµÑ‰Ð¸, Ð·Ð° ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ð½Ñ‹ ÑÐµÐ³Ð¾Ð´Ð½Ñ\n"
            "- ÐŸÐ¾Ð´ÐµÐ»Ð¸Ñ‚ÐµÑÑŒ Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ð½Ð¾ÑÑ‚ÑŒÑŽ Ñ Ð±Ð»Ð¸Ð·ÐºÐ¸Ð¼ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÐ¾Ð¼\n\n"
            "ðŸ’« ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚: Ð¡Ð¼ÐµÑ‰Ð°ÐµÑ‚ Ñ„Ð¾ÐºÑƒÑ Ð½Ð° Ð¿Ð¾Ð·Ð¸Ñ‚Ð¸Ð²"
        )
    ],
    "Ð¡Ð¿Ð¾ÐºÐ¾Ð¹ÑÑ‚Ð²Ð¸Ðµ": [
        (
            "ðŸ•¯ï¸ ÐŸÑ€Ð°ÐºÑ‚Ð¸ÐºÐ° Â«Ð§Ð°Ð¹Ð½Ð°Ñ Ñ†ÐµÑ€ÐµÐ¼Ð¾Ð½Ð¸ÑÂ»\n\n"
            "Ð˜Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ñ:\n"
            "- ÐŸÑ€Ð¸Ð³Ð¾Ñ‚Ð¾Ð²ÑŒÑ‚Ðµ Ñ‡Ð°Ð¹ Ð¾ÑÐ¾Ð·Ð½Ð°Ð½Ð½Ð¾: Ð½Ð°Ð±Ð»ÑŽÐ´Ð°Ð¹Ñ‚Ðµ Ð·Ð° Ñ†Ð²ÐµÑ‚Ð¾Ð¼, Ð¿Ð°Ñ€Ð¾Ð¼, Ð°Ñ€Ð¾Ð¼Ð°Ñ‚Ð¾Ð¼\n"
            "- ÐŸÐµÐ¹Ñ‚Ðµ Ð¼ÐµÐ´Ð»ÐµÐ½Ð½Ð¾, ÐºÐ¾Ð½Ñ†ÐµÐ½Ñ‚Ñ€Ð¸Ñ€ÑƒÑÑÑŒ Ð½Ð° Ð²ÐºÑƒÑÐµ\n\n"
            "ðŸµ Ð­Ñ„Ñ„ÐµÐºÑ‚: Ð—Ð°Ð¼ÐµÐ´Ð»ÑÐµÑ‚ Ñ€Ð¸Ñ‚Ð¼, ÑÐ½Ð¸Ð¶Ð°ÐµÑ‚ Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ"
        ),
        (
            "ðŸŒ€ Ð”Ñ‹Ñ…Ð°Ð½Ð¸Ðµ 4-7-8\n\n"
            "Ð˜Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ñ:\n"
            "- Ð’Ð´Ð¾Ñ… Ñ‡ÐµÑ€ÐµÐ· Ð½Ð¾Ñ (4 ÑÐµÐº)\n"
            "- Ð—Ð°Ð´ÐµÑ€Ð¶ÐºÐ° Ð´Ñ‹Ñ…Ð°Ð½Ð¸Ñ (7 ÑÐµÐº)\n"
            "- Ð’Ñ‹Ð´Ð¾Ñ… Ñ‡ÐµÑ€ÐµÐ· Ñ€Ð¾Ñ‚ (8 ÑÐµÐº)\n\n"
            "ðŸ’¨ ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚Ðµ 4 Ñ†Ð¸ÐºÐ»Ð°\n"
            "âœ¨ Ð­Ñ„Ñ„ÐµÐºÑ‚: Ð‘Ð°Ð»Ð°Ð½ÑÐ¸Ñ€ÑƒÐµÑ‚ Ð½ÐµÑ€Ð²Ð½ÑƒÑŽ ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ\n"
            "â•Ð’Ð¾ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ÑÑ ÐºÐ½Ð¾Ð¿ÐºÐ¾Ð¹ Ð”Ñ‹Ñ…Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð´ÐµÐ»Ð°Ñ‚ÑŒ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ñ Ð²Ð¼ÐµÑÑ‚Ðµ!"
        )
    ],
    "Ð’Ð´Ð¾Ñ…Ð½Ð¾Ð²ÐµÐ½Ð¸Ðµ": [
        (
            "ðŸš€ ÐœÐµÑ‚Ð¾Ð´ Â«Ð¡Ð»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ð¹ Ð²Ñ…Ð¾Ð´Â»\n\n"
            "Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ:\n"
            "- ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ ÐºÐ½Ð¸Ð³Ñƒ Ð½Ð° ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ð¾Ð¹ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ðµ â†’ Ð¿Ñ€Ð¾Ñ‡Ñ‚Ð¸Ñ‚Ðµ Ð°Ð±Ð·Ð°Ñ†\n"
            "- Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Ñ€Ð°Ð´Ð¸Ð¾ â†’ Ð·Ð°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð¿ÐµÑ€Ð²ÑƒÑŽ ÑƒÑÐ»Ñ‹ÑˆÐ°Ð½Ð½ÑƒÑŽ Ñ„Ñ€Ð°Ð·Ñƒ\n\n"
            "ðŸŽ² ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚: Ð¡Ñ‚Ð¸Ð¼ÑƒÐ»Ð¸Ñ€ÑƒÐµÑ‚ Ð°ÑÑÐ¾Ñ†Ð¸Ð°Ñ‚Ð¸Ð²Ð½Ð¾Ðµ Ð¼Ñ‹ÑˆÐ»ÐµÐ½Ð¸Ðµ"
        ),
        (
            "ðŸ“¸ Ð¤Ð¾Ñ‚Ð¾-Ñ‡ÐµÐ»Ð»ÐµÐ½Ð´Ð¶ Â«ÐÐ¾Ð²Ñ‹Ð¹ Ð²Ð·Ð³Ð»ÑÐ´Â»\n\n"
            "Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ:\n"
            "- Ð¡Ñ„Ð¾Ñ‚Ð¾Ð³Ñ€Ð°Ñ„Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ 5 Ð¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ñ… Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚Ð¾Ð² Ð½ÐµÐ¾Ð±Ñ‹Ñ‡Ð½Ñ‹Ð¼ ÑÐ¿Ð¾ÑÐ¾Ð±Ð¾Ð¼\n"
            "- ÐŸÐ¾Ð´ÐµÐ»Ð¸Ñ‚ÐµÑÑŒ Ñ Ð´Ñ€ÑƒÐ³Ð¾Ð¼ Ð¸Ð»Ð¸ Ð² ÑÐ¾Ñ†ÑÐµÑ‚ÑÑ…\n\n"
            "ðŸ” Ð­Ñ„Ñ„ÐµÐºÑ‚: Ð Ð°Ð·Ð²Ð¸Ð²Ð°ÐµÑ‚ ÐºÑ€ÐµÐ°Ñ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ"
        )
    ],
    "Ð£Ð²ÐµÑ€ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ": [
        (
            "ðŸ’ª ÐŸÑ€Ð°ÐºÑ‚Ð¸ÐºÐ° Â«ÐŸÐ¾Ð·Ð° ÑÑƒÐ¿ÐµÑ€Ð³ÐµÑ€Ð¾ÑÂ»\n\n"
            "Ð˜Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ñ:\n"
            "- Ð’ÑÑ‚Ð°Ð½ÑŒÑ‚Ðµ Ð¿Ñ€ÑÐ¼Ð¾, Ñ€ÑƒÐºÐ¸ Ð½Ð° Ð±ÐµÐ´Ñ€Ð°Ñ…, Ð¿Ð¾Ð´Ð±Ð¾Ñ€Ð¾Ð´Ð¾Ðº Ð¿Ñ€Ð¸Ð¿Ð¾Ð´Ð½ÑÑ‚\n"
            "- Ð£Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°Ð¹Ñ‚Ðµ Ð¿Ð¾Ð·Ñƒ 2 Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹\n\n"
            "ðŸ¦¸ Ð­Ñ„Ñ„ÐµÐºÑ‚: ÐŸÐ¾Ð²Ñ‹ÑˆÐ°ÐµÑ‚ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ñ‚ÐµÑÑ‚Ð¾ÑÑ‚ÐµÑ€Ð¾Ð½Ð°"
        ),
        (
            "ðŸ“– ÐÑ„Ñ„Ð¸Ñ€Ð¼Ð°Ñ†Ð¸Ð¸ Ð´Ð»Ñ ÑƒÐ²ÐµÑ€ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸\n\n"
            "ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹:\n"
            "- Â«Ð¯ ÑÐ¿Ñ€Ð°Ð²Ð»ÑÐ»ÑÑ Ñ Ñ‚Ñ€ÑƒÐ´Ð½Ð¾ÑÑ‚ÑÐ¼Ð¸ Ñ€Ð°Ð½ÑŒÑˆÐµ â€” ÑÐ¿Ñ€Ð°Ð²Ð»ÑŽÑÑŒ Ð¸ ÑÐµÐ¹Ñ‡Ð°ÑÂ»\n"
            "- Â«ÐœÐ¾Ðµ Ð¼Ð½ÐµÐ½Ð¸Ðµ Ð²Ð°Ð¶Ð½Ð¾Â»\n\n"
            "ðŸ” ÐŸÑ€Ð¾Ð¸Ð·Ð½Ð¾ÑÐ¸Ñ‚Ðµ Ð²ÑÐ»ÑƒÑ… Ð¿ÐµÑ€ÐµÐ´ Ð·ÐµÑ€ÐºÐ°Ð»Ð¾Ð¼"
        )
    ]

}
# Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ñ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÐ°
EMOTION_MAPPING = {
    "anxiety": "Ð¢Ñ€ÐµÐ²Ð¾Ð³Ð°",
    "stress": "Ð¡Ñ‚Ñ€ÐµÑÑ",
    "fatigue": "Ð£ÑÑ‚Ð°Ð»Ð¾ÑÑ‚ÑŒ",
    "anger": "Ð“Ð½ÐµÐ²",
    "loneliness": "ÐžÐ´Ð¸Ð½Ð¾Ñ‡ÐµÑÑ‚Ð²Ð¾",
    "apathy": "ÐÐ¿Ð°Ñ‚Ð¸Ñ",
    "worry": "Ð‘ÐµÑÐ¿Ð¾ÐºÐ¾Ð¹ÑÑ‚Ð²Ð¾", 
    "overload": "ÐŸÐµÑ€ÐµÐ³Ñ€ÑƒÐ·ÐºÐ°",
    "confidence": "Ð£Ð²ÐµÑ€ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ",
    "inspiration": "Ð’Ð´Ð¾Ñ…Ð½Ð¾Ð²ÐµÐ½Ð¸Ðµ",
    "calm": "Ð¡Ð¿Ð¾ÐºÐ¾Ð¹ÑÑ‚Ð²Ð¸Ðµ",
    "joy": "Ð Ð°Ð´Ð¾ÑÑ‚ÑŒ"
}

# Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¿Ð¾ Ñ‚ÐµÑÑ‚Ñƒ
SPIELBERGER_QUESTIONS = [
    # ÑÐ¸Ñ‚ÑƒÐ°Ñ‚Ð¸Ð²Ð½Ð°Ñ Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ (1-20)
    "1. Ð¯ ÑÐ¿Ð¾ÐºÐ¾ÐµÐ½",
    "2. ÐœÐ½Ðµ Ð½Ð¸Ñ‡Ñ‚Ð¾ Ð½Ðµ ÑƒÐ³Ñ€Ð¾Ð¶Ð°ÐµÑ‚",
    "3. Ð¯ Ð½Ð°Ñ…Ð¾Ð¶ÑƒÑÑŒ Ð² Ð½Ð°Ð¿Ñ€ÑÐ¶ÐµÐ½Ð¸Ð¸",
    "4. Ð¯ Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½Ðµ ÑÐºÐ¾Ð²Ð°Ð½",
    "5. Ð¯ Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÑŽ ÑÐµÐ±Ñ ÑÐ²Ð¾Ð±Ð¾Ð´Ð½Ð¾",
    "6. Ð¯ Ñ€Ð°ÑÑÑ‚Ñ€Ð¾ÐµÐ½",
    "7. ÐœÐµÐ½Ñ Ð²Ð¾Ð»Ð½ÑƒÑŽÑ‚ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ðµ Ð½ÐµÑƒÐ´Ð°Ñ‡Ð¸",
    "8. Ð¯ Ð¾Ñ‰ÑƒÑ‰Ð°ÑŽ Ð´ÑƒÑˆÐµÐ²Ð½Ñ‹Ð¹ Ð¿Ð¾ÐºÐ¾Ð¹",
    "9. Ð¯ Ð²ÑÑ‚Ñ€ÐµÐ²Ð¾Ð¶ÐµÐ½",
    "10. Ð¯ Ð¸ÑÐ¿Ñ‹Ñ‚Ñ‹Ð²Ð°ÑŽ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¾ Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÐµÐ³Ð¾ ÑƒÐ´Ð¾Ð²Ð»ÐµÑ‚Ð²Ð¾Ñ€ÐµÐ½Ð¸Ñ",
    "11. Ð¯ ÑƒÐ²ÐµÑ€ÐµÐ½ Ð² ÑÐµÐ±Ðµ",
    "12. Ð¯ Ð½ÐµÑ€Ð²Ð½Ð¸Ñ‡Ð°ÑŽ",
    "13. Ð¯ Ð½Ðµ Ð½Ð°Ñ…Ð¾Ð¶Ñƒ ÑÐµÐ±Ðµ Ð¼ÐµÑÑ‚Ð°",
    "14. Ð¯ Ð²Ð·Ð²Ð¸Ð½Ñ‡ÐµÐ½",
    "15. Ð¯ Ð½Ðµ Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÑŽ ÑÐºÐ¾Ð²Ð°Ð½Ð½Ð¾ÑÑ‚Ð¸, Ð½Ð°Ð¿Ñ€ÑÐ¶ÐµÐ½Ð¸Ñ",
    "16. Ð¯ Ð´Ð¾Ð²Ð¾Ð»ÐµÐ½",
    "17. Ð¯ Ð¾Ð·Ð°Ð±Ð¾Ñ‡ÐµÐ½",
    "18. Ð¯ ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ð²Ð¾Ð·Ð±ÑƒÐ¶Ð´ÐµÐ½ Ð¸ Ð¼Ð½Ðµ Ð½Ðµ Ð¿Ð¾ ÑÐµÐ±Ðµ",
    "19. ÐœÐ½Ðµ Ñ€Ð°Ð´Ð¾ÑÑ‚Ð½Ð¾",
    "20. ÐœÐ½Ðµ Ð¿Ñ€Ð¸ÑÑ‚Ð½Ð¾",
    # Ð»Ð¸Ñ‡Ð½Ð¾ÑÑ‚Ð½Ð°Ñ Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ (21-40)
    "21. Ð£ Ð¼ÐµÐ½Ñ Ð±Ñ‹Ð²Ð°ÐµÑ‚ Ð¿Ñ€Ð¸Ð¿Ð¾Ð´Ð½ÑÑ‚Ð¾Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ",
    "22. Ð¯ Ð±Ñ‹Ð²Ð°ÑŽ Ñ€Ð°Ð·Ð´Ñ€Ð°Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¼",
    "23. Ð¯ Ð»ÐµÐ³ÐºÐ¾ Ñ€Ð°ÑÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÑŽÑÑŒ",
    "24. Ð¯ Ñ…Ð¾Ñ‚ÐµÐ» Ð±Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ñ‚Ð°ÐºÐ¸Ð¼ Ð¶Ðµ ÑƒÐ´Ð°Ñ‡Ð»Ð¸Ð²Ñ‹Ð¼, ÐºÐ°Ðº Ð¸ Ð´Ñ€ÑƒÐ³Ð¸Ðµ",
    "25. Ð¯ ÑÐ¸Ð»ÑŒÐ½Ð¾ Ð¿ÐµÑ€ÐµÐ¶Ð¸Ð²Ð°ÑŽ Ð½ÐµÐ¿Ñ€Ð¸ÑÑ‚Ð½Ð¾ÑÑ‚Ð¸ Ð¸ Ð´Ð¾Ð»Ð³Ð¾ Ð½Ðµ Ð¼Ð¾Ð³Ñƒ Ð¾ Ð½Ð¸Ñ… Ð·Ð°Ð±Ñ‹Ñ‚ÑŒ",
    "26. Ð¯ Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÑŽ Ð¿Ñ€Ð¸Ð»Ð¸Ð² ÑÐ¸Ð» Ð¸ Ð¶ÐµÐ»Ð°Ð½Ð¸Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ",
    "27. Ð¯ ÑÐ¿Ð¾ÐºÐ¾ÐµÐ½, Ñ…Ð»Ð°Ð´Ð½Ð¾ÐºÑ€Ð¾Ð²ÐµÐ½ Ð¸ ÑÐ¾Ð±Ñ€Ð°Ð½",
    "28. ÐœÐµÐ½Ñ Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð°Ñ‚ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ðµ Ñ‚Ñ€ÑƒÐ´Ð½Ð¾ÑÑ‚Ð¸",
    "29. Ð¯ ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ð¿ÐµÑ€ÐµÐ¶Ð¸Ð²Ð°ÑŽ Ð¸Ð·-Ð·Ð° Ð¿ÑƒÑÑ‚ÑÐºÐ¾Ð²",
    "30. Ð¯ Ð±Ñ‹Ð²Ð°ÑŽ Ð²Ð¿Ð¾Ð»Ð½Ðµ ÑÑ‡Ð°ÑÑ‚Ð»Ð¸Ð²",
    "31. Ð¯ Ð²ÑÐµ Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÑŽ Ð±Ð»Ð¸Ð·ÐºÐ¾ Ðº ÑÐµÑ€Ð´Ñ†Ñƒ",
    "32. ÐœÐ½Ðµ Ð½Ðµ Ñ…Ð²Ð°Ñ‚Ð°ÐµÑ‚ ÑƒÐ²ÐµÑ€ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸ Ð² ÑÐµÐ±Ðµ",
    "33. Ð¯ Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÑŽ ÑÐµÐ±Ñ Ð±ÐµÐ·Ð·Ð°Ñ‰Ð¸Ñ‚Ð½Ñ‹Ð¼",
    "34. Ð¯ ÑÑ‚Ð°Ñ€Ð°ÑŽÑÑŒ Ð¸Ð·Ð±ÐµÐ³Ð°Ñ‚ÑŒ ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ð¸Ð¹ Ð¸ Ñ‚Ñ€ÑƒÐ´Ð½Ð¾ÑÑ‚ÐµÐ¹",
    "35. Ð£ Ð¼ÐµÐ½Ñ Ð±Ñ‹Ð²Ð°ÐµÑ‚ Ñ…Ð°Ð½Ð´Ñ€Ð°",
    "36. Ð¯ Ð±Ñ‹Ð²Ð°ÑŽ Ð´Ð¾Ð²Ð¾Ð»ÐµÐ½",
    "37. Ð’ÑÑÐºÐ¸Ðµ Ð¿ÑƒÑÑ‚ÑÐºÐ¸ Ð¾Ñ‚Ð²Ð»ÐµÐºÐ°ÑŽÑ‚ Ð¸ Ð²Ð¾Ð»Ð½ÑƒÑŽÑ‚ Ð¼ÐµÐ½Ñ",
    "38. Ð‘Ñ‹Ð²Ð°ÐµÑ‚, Ñ‡Ñ‚Ð¾ Ñ Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÑŽ ÑÐµÐ±Ñ Ð½ÐµÑƒÐ´Ð°Ñ‡Ð½Ð¸ÐºÐ¾Ð¼",
    "39. Ð¯ ÑƒÑ€Ð°Ð²Ð½Ð¾Ð²ÐµÑˆÐµÐ½Ð½Ñ‹Ð¹ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº",
    "40. ÐœÐµÐ½Ñ Ð¾Ñ…Ð²Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ Ð±ÐµÑÐ¿Ð¾ÐºÐ¾Ð¹ÑÑ‚Ð²Ð¾, ÐºÐ¾Ð³Ð´Ð° Ñ Ð´ÑƒÐ¼Ð°ÑŽ Ð¾ ÑÐ²Ð¾Ð¸Ñ… Ð´ÐµÐ»Ð°Ñ… Ð¸ Ð·Ð°Ð±Ð¾Ñ‚Ð°Ñ…"
]

ANSWER_OPTIONS = [
    ("ÐÐ¸ÐºÐ¾Ð³Ð´Ð°", "0"),
    ("ÐŸÐ¾Ñ‡Ñ‚Ð¸ Ð½Ð¸ÐºÐ¾Ð³Ð´Ð°", "1"),
    ("Ð§Ð°ÑÑ‚Ð¾", "2"),
    ("ÐŸÐ¾Ñ‡Ñ‚Ð¸ Ð²ÑÐµÐ³Ð´Ð°", "3")
]

# ÐºÐ»ÑŽÑ‡ Ð´Ð»Ñ Ð¿Ñ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²
INVERTED_QUESTIONS = [1, 2, 5, 8, 10, 11, 15, 16, 19, 20, 21, 26, 27, 30, 36, 39]

# ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð½Ð° ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ðµ
keyboard = [
        ["ðŸ’¨ Ð”Ñ‹Ñ…Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ", "ðŸ’¡ Ð¡Ð¾Ð²ÐµÑ‚ Ð´Ð»Ñ ÑƒÑÐ¿Ð¾ÐºÐ¾ÐµÐ½Ð¸Ñ"],
        ["ðŸ“ Ð¢ÐµÑÑ‚ Ð½Ð° Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ", "ðŸŽ§ Ð ÐµÐ»Ð°ÐºÑÐ°Ñ†Ð¸Ñ"],
        ["ðŸŒ± Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ ÑÐ¼Ð¾Ñ†Ð¸ÑŽ", "âš™ï¸ Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾Ñ‚Ð´Ñ‹Ñ…Ðµ"]]


# ÑÐ»Ð¾Ð²Ð°Ñ€ÑŒ Ð´Ð»Ñ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
user_notifications = {}

# Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ñ‰Ð¸ÐºÐ°
scheduler = AsyncIOScheduler()

# Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ
async def start(update: Update, context: CallbackContext):
    user = update.message.from_user.first_name
    
    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True, one_time_keyboard=False)
    
    await update.message.reply_text(
        f"ÐŸÑ€Ð¸Ð²ÐµÑ‚, {user}! Ð¯ Ð±Ð¾Ñ‚ Ð´Ð»Ñ ÑÐ¼Ð¾Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ñ€Ð°Ð·Ð³Ñ€ÑƒÐ·ÐºÐ¸.Ð”Ð°Ð²Ð°Ð¹ Ð²Ð¼ÐµÑÑ‚Ðµ ÑÐ½Ð¸Ð·Ð¸Ð¼ ÑÑ‚Ñ€ÐµÑÑ Ð¸ Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ.ðŸ˜Š Ð’Ð¾Ñ‚ Ñ‡Ñ‚Ð¾ Ñ ÑƒÐ¼ÐµÑŽ:\n\n"
        "ðŸ’¨ Ð´Ñ‹Ñ…Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ\n"
        "ðŸ’¡ ÑÐ¾Ð²ÐµÑ‚Ñ‹ Ð´Ð»Ñ ÑƒÑÐ¿Ð¾ÐºÐ¾ÐµÐ½Ð¸Ñ\n"
        "ðŸ“ Ñ‚ÐµÑÑ‚ Ð½Ð° ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸\n\n"
        "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ ÐºÐ½Ð¾Ð¿Ð¾Ðº Ð½Ð° ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ðµ â¬‡ï¸",
        reply_markup = reply_markup
    )
    
    
# Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð´Ð»Ñ ÐºÐ½Ð¾Ð¿Ð¾Ðº Ð½Ð° ÐºÐ»Ð°Ð²
async def handle_buttons(update: Update, context: CallbackContext):
    text = update.message.text

    if text == "ðŸ’¨ Ð”Ñ‹Ñ…Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ":
        await guided_breathing_start(update, context)
    elif text == "ðŸ’¡ Ð¡Ð¾Ð²ÐµÑ‚ Ð´Ð»Ñ ÑƒÑÐ¿Ð¾ÐºÐ¾ÐµÐ½Ð¸Ñ":
        await random_advice(update, context)
    elif text == "ðŸ“ Ð¢ÐµÑÑ‚ Ð½Ð° Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ":
        await anxiety_test(update, context)
    elif text == "ðŸŽ§ Ð ÐµÐ»Ð°ÐºÑÐ°Ñ†Ð¸Ñ":
        await audio_menu(update, context)
    elif text == "ðŸŒ± Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ ÑÐ¼Ð¾Ñ†Ð¸ÑŽ": 
        await emotion_selection(update, context)
    elif text == "âš™ï¸ Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾Ñ‚Ð´Ñ‹Ñ…Ðµ":
        await settings_menu(update, context)

# Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð´Ð»Ñ Ð´Ñ‹Ñ… ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ñ
async def guided_breathing(update: Update, context: CallbackContext):
    query = update.callback_query
    await query.answer()

    await query.message.edit_text("Ð’Ð´Ð¾Ñ…Ð½Ð¸Ñ‚Ðµ Ñ‡ÐµÑ€ÐµÐ· Ð½Ð¾Ñ Ð½Ð° 4 ÑÐµÐºÑƒÐ½Ð´Ñ‹... ðŸ˜Œ")
    await asyncio.sleep(3)

    await query.message.edit_text("Ð—Ð°Ð´ÐµÑ€Ð¶Ð¸Ñ‚Ðµ Ð´Ñ‹Ñ…Ð°Ð½Ð¸Ðµ Ð½Ð° 7 ÑÐµÐºÑƒÐ½Ð´... â³")
    await asyncio.sleep(6)

    await query.message.edit_text("ÐœÐµÐ´Ð»ÐµÐ½Ð½Ð¾ Ð²Ñ‹Ð´Ð¾Ñ…Ð½Ð¸Ñ‚Ðµ Ñ‡ÐµÑ€ÐµÐ· Ñ€Ð¾Ñ‚ Ð½Ð° 8 ÑÐµÐºÑƒÐ½Ð´... ðŸŒ¬ï¸")
    await asyncio.sleep(7)

    await query.message.edit_text("ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾! ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚Ðµ 4 Ñ€Ð°Ð·Ð° Ð´Ð»Ñ Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ ÑÑ„Ñ„ÐµÐºÑ‚Ð°.")
        
async def audio_menu(update: Update, context: ContextTypes.DEFAULT_TYPE):
    buttons = [
        [InlineKeyboardButton("ðŸŒ§ Ð”Ð¾Ð¶Ð´ÑŒ", callback_data="audio_rain")],
        [InlineKeyboardButton("ðŸŒ² Ð›ÐµÑ", callback_data="audio_forest")]
    ]
    await update.message.reply_text(
        "ðŸŽ§ Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð·Ð²ÑƒÐºÐ¾Ð²ÑƒÑŽ Ñ‚ÐµÑ€Ð°Ð¿Ð¸ÑŽ:",
        reply_markup=InlineKeyboardMarkup(buttons)
    )
# Ð±Ð°Ð·Ð° Ð°ÑƒÐ´Ð¸Ð¾Ñ„Ð°Ð¹Ð»Ð¾Ð²
AUDIO_LIBRARY = {
    "rain": {
        "file": os.path.abspath(os.path.join("music", "rain.mp3")), 
        "duration": 53
    },
    "forest": {
        "file": os.path.abspath(os.path.join("music", "forest.mp3")),
        "duration": 329
    }
}

async def play_audio(update: Update, context: CallbackContext):
    query = update.callback_query
    sound_key = query.data.split("_")[1]

    if sound_key not in AUDIO_LIBRARY:
        await query.message.reply_text("ÐžÑˆÐ¸Ð±ÐºÐ°: ÐÑƒÐ´Ð¸Ð¾Ñ„Ð°Ð¹Ð» Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½ Ð² Ð±Ð°Ð·Ðµ.")
        return

    audio_file = AUDIO_LIBRARY[sound_key]["file"] 

    # print(f"ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿ÑƒÑ‚Ð¸: {audio_file}")

    if not os.path.exists(audio_file):
        await query.message.reply_text(f"ÐžÑˆÐ¸Ð±ÐºÐ°: ÐÑƒÐ´Ð¸Ð¾Ñ„Ð°Ð¹Ð» Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½ Ð¿Ð¾ Ð¿ÑƒÑ‚Ð¸ {audio_file}.")
        return

    await query.answer()
    await query.message.reply_text(f"ðŸŽ¶ ÐŸÐ¾Ð´Ð¾Ð¶Ð´Ð¸Ñ‚Ðµ Ð¿Ð¾ÐºÐ° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑÑ {sound_key} Ð¸ Ð½Ð°ÑÐ»Ð°Ð¶Ð´Ð°Ð¹Ñ‚ÐµÑÑŒ Ð¼ÑƒÐ·Ñ‹ÐºÐ¾Ð¹!")

    with open(audio_file, "rb") as audio:
        await query.message.reply_audio(audio=audio)
        
        
        
# Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ðº Ð´Ñ‹Ñ… ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸ÑŽ
async def guided_breathing_start(update: Update, context: CallbackContext):
    keyboard = [[InlineKeyboardButton("Ð”Ð°Ð»ÐµÐµ â–¶ï¸", callback_data="start_breathing")]]
    reply_markup = InlineKeyboardMarkup(keyboard)

    await update.message.reply_text(
        "ÐŸÑ€Ð¸Ð³Ð¾Ñ‚Ð¾Ð²ÑŒÑ‚ÐµÑÑŒ Ðº Ð´Ñ‹Ñ…Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¼Ñƒ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸ÑŽ. \n\n"
        "Ð¯ Ð±ÑƒÐ´Ñƒ Ð¾Ñ‚ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒ Ð²Ñ€ÐµÐ¼Ñ, Ð° Ð²Ñ‹ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐ¹Ñ‚Ðµ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ. \n\n"
        "ÐÐ°Ñ‡Ð½ÐµÐ¼!ðŸ”¥",
        reply_markup=reply_markup
    )

# ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ð¹ ÑÐ¾Ð²ÐµÑ‚
async def random_advice(update, context):
    try:
        db_path = Path(__file__).parent / "motivation_db.json"
        
        with open(db_path, "r", encoding="utf-8") as f:
            advice_list = json.load(f)
        
        advice = random.choice(advice_list)
        author = f"\n â€” {advice['author']}" if advice.get("author") else ""
        quote = f"ðŸ“Œ {advice['text']}{author}"
        
    except FileNotFoundError:
        quote = "âš ï¸ Ð¤Ð°Ð¹Ð» Ñ ÑÐ¾Ð²ÐµÑ‚Ð°Ð¼Ð¸ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½!"
    except json.JSONDecodeError:
        quote = "âš ï¸ ÐžÑˆÐ¸Ð±ÐºÐ° Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ Ñ„Ð°Ð¹Ð»Ð°!"
    except Exception as e:
        quote = f"âš ï¸ ÐžÑˆÐ¸Ð±ÐºÐ°: {str(e)}"
    
    await update.message.reply_text(quote)

# ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ñ Ð¿Ð¾ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸ÑŽ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÐ°
async def emotion_selection(update: Update, context: ContextTypes.DEFAULT_TYPE):
    buttons = [
        [InlineKeyboardButton("Ð¢Ñ€ÐµÐ²Ð¾Ð³Ð°", callback_data="emotion_anxiety"),
         InlineKeyboardButton("Ð¡Ñ‚Ñ€ÐµÑÑ", callback_data="emotion_stress")],
        [InlineKeyboardButton("Ð£ÑÑ‚Ð°Ð»Ð¾ÑÑ‚ÑŒ", callback_data="emotion_fatigue"),
         InlineKeyboardButton("Ð“Ð½ÐµÐ²", callback_data="emotion_anger")],
        [InlineKeyboardButton("ÐžÐ´Ð¸Ð½Ð¾Ñ‡ÐµÑÑ‚Ð²Ð¾", callback_data="emotion_loneliness"),
         InlineKeyboardButton("ÐÐ¿Ð°Ñ‚Ð¸Ñ", callback_data="emotion_apathy")],
        [InlineKeyboardButton("Ð£Ð²ÐµÑ€ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ", callback_data="emotion_confidence"),
         InlineKeyboardButton("Ð’Ð´Ð¾Ñ…Ð½Ð¾Ð²ÐµÐ½Ð¸Ðµ", callback_data="emotion_inspiration")],
        [InlineKeyboardButton("Ð¡Ð¿Ð¾ÐºÐ¾Ð¹ÑÑ‚Ð²Ð¸Ðµ", callback_data="emotion_calm"),
         InlineKeyboardButton("Ð Ð°Ð´Ð¾ÑÑ‚ÑŒ", callback_data="emotion_joy")]
    ]
    await update.message.reply_text(
        "ðŸ“Œ Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð²Ð°ÑˆÐµ Ñ‚ÐµÐºÑƒÑ‰ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ:",
        reply_markup=InlineKeyboardMarkup(buttons)
    )

# Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ð¹ Ð¿Ð¾ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸ÑŽ
async def handle_emotion(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    emotion_key = query.data.split("_")[1] 

    emotion = EMOTION_MAPPING.get(emotion_key, None)

    if emotion is None:
        await query.message.edit_text("âš ï¸ ÐžÑˆÐ¸Ð±ÐºÐ°: Ð½ÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð°Ñ ÑÐ¼Ð¾Ñ†Ð¸Ñ!")
        return

    advice = random.choice(EMOTION_ADVICE[emotion])

    await query.message.edit_text(
        f"ðŸŒŸ Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ð¿Ñ€Ð¸ {emotion}:\n\n{advice}"
    )

# Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸ Ñ‚ÐµÑÑ‚Ð°
async def anxiety_test(update: Update, context: ContextTypes.DEFAULT_TYPE):
    context.user_data["test_step"] = 0
    context.user_data["scores"] = []
    keyboard = [[InlineKeyboardButton("ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ñ‚ÐµÑÑ‚", callback_data="start_test")]]
    await update.message.reply_text("Ð­Ñ‚Ð¾Ñ‚ Ñ‚ÐµÑÑ‚ Ð¿Ð¾Ð¼Ð¾Ð³Ð°ÐµÑ‚ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸. Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ:", reply_markup=InlineKeyboardMarkup(keyboard))

async def send_question(update: Update, context: ContextTypes.DEFAULT_TYPE):
    step = context.user_data["test_step"]
    
    if step >= len(SPIELBERGER_QUESTIONS):
        await finish_test(update, context)
        return
    
    buttons = [[InlineKeyboardButton(text, callback_data=value)] for text, value in ANSWER_OPTIONS]
    if step > 0:
        buttons.append([InlineKeyboardButton("â—€ï¸ ÐÐ°Ð·Ð°Ð´", callback_data="prev_question")])
    
    reply_markup = InlineKeyboardMarkup(buttons)
    text = f"Ð’Ð¾Ð¿Ñ€Ð¾Ñ {step+1}/{len(SPIELBERGER_QUESTIONS)}:\n{SPIELBERGER_QUESTIONS[step]}"
    
    if update.callback_query:
        await update.callback_query.message.edit_text(text, reply_markup=reply_markup)
    else:
        await update.message.reply_text(text, reply_markup=reply_markup)

async def handle_test_answer(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    if query.data == "start_test":
        await send_question(update, context)
        return
    
    if query.data == "prev_question":
        if context.user_data["test_step"] > 0:
            context.user_data["test_step"] -= 1
        await send_question(update, context)
        return
    
    step = context.user_data["test_step"]
    raw_score = int(query.data)
    score = 4 - raw_score if (step + 1) in INVERTED_QUESTIONS else raw_score + 1
    context.user_data["scores"].append(score)
    
    context.user_data["test_step"] += 1
    await send_question(update, context)

def get_anxiety_level(score):
    if score < 12:
        return "Ð¾Ñ‡ÐµÐ½ÑŒ Ð½Ð¸Ð·ÐºÐ°Ñ"
    elif 12 <= score <= 30:
        return "Ð½Ð¸Ð·ÐºÐ°Ñ"
    elif 31 <= score <= 44:
        return "ÑƒÐ¼ÐµÑ€ÐµÐ½Ð½Ð°Ñ"
    else:
        return "Ð²Ñ‹ÑÐ¾ÐºÐ°Ñ"

async def finish_test(update: Update, context: ContextTypes.DEFAULT_TYPE):
    scores = context.user_data.get("scores", [])
    st_score = sum(scores[:20])
    lt_score = sum(scores[20:])
    
    def get_description(score, type_name):
        level = get_anxiety_level(score)
        text = ""
        
        # ÑÐ¾Ð²ÐµÑ‚Ñ‹ Ð´Ð»Ñ Ð¡Ð¢ Ð¸ Ð›Ð¢ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ ÑƒÑ€Ð¾Ð²Ð½Ñ
        if level == "Ð¾Ñ‡ÐµÐ½ÑŒ Ð½Ð¸Ð·ÐºÐ°Ñ":
            if type_name == "Ð¡Ð¸Ñ‚ÑƒÐ°Ñ‚Ð¸Ð²Ð½Ð°Ñ Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ":
                text = (
                    "âš ï¸ Ð¡Ð¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð°Ð¿Ð°Ñ‚Ð¸Ð¸ Ð¸Ð»Ð¸ Ð¾Ñ‚Ñ€Ð¸Ñ†Ð°Ð½Ð¸Ðµ ÑÑ‚Ñ€ÐµÑÑÐ°. Ð¡Ð¾Ð²ÐµÑ‚: "
                    "ðŸ§˜ Ð¢ÐµÑ…Ð½Ð¸ÐºÐ¸ Â«Ð·Ð´ÐµÑÑŒ Ð¸ ÑÐµÐ¹Ñ‡Ð°ÑÂ»: Ð´Ñ‹Ñ…Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ñ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, 4-7-8), Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑÐ¸Ð²Ð½Ð°Ñ Ð¼Ñ‹ÑˆÐµÑ‡Ð½Ð°Ñ Ñ€ÐµÐ»Ð°ÐºÑÐ°Ñ†Ð¸Ñ."
                    "ðŸ“ ÐŸÐ»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ: Ñ€Ð°Ð·Ð±Ð¸Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ð½Ð° ÑÑ‚Ð°Ð¿Ñ‹, ÑÐ¾ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ñ‡ÐµÑ‚ÐºÐ¸Ð¹ Ð¿Ð»Ð°Ð½ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹."
                    "â³ ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ðµ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð½Ð° Ñ‚Ñ€ÐµÐ²Ð¾Ð³Ñƒ: Ð²Ñ‹Ð´ÐµÐ»Ð¸Ñ‚ÑŒ 10â€“15 Ð¼Ð¸Ð½ÑƒÑ‚ Ð² Ð´ÐµÐ½ÑŒ Ð½Ð° Ð°Ð½Ð°Ð»Ð¸Ð· Ð¿ÐµÑ€ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ð¹."
                )
            else:  # Ð»Ð¸Ñ‡Ð½Ð¾ÑÑ‚Ð½Ð°Ñ
                text = (
                    "ðŸ” Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð° Ð¿Ð¾Ð´Ð°Ð²Ð»ÐµÐ½Ð½Ð°Ñ Ñ‚Ñ€ÐµÐ²Ð¾Ð³Ð° Ð¸Ð»Ð¸ Ð½Ð¸Ð·ÐºÐ°Ñ ÑÐ°Ð¼Ð¾Ð¾Ñ†ÐµÐ½ÐºÐ°. "
                    "Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ: Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ð´Ð½ÐµÐ²Ð½Ð¸ÐºÐ° ÑÐ¼Ð¾Ñ†Ð¸Ð¹, ÐºÐ¾Ð½ÑÑƒÐ»ÑŒÑ‚Ð°Ñ†Ð¸Ñ Ð¿ÑÐ¸Ñ…Ð¾Ð»Ð¾Ð³Ð°."
                )
                
        elif level == "Ð½Ð¸Ð·ÐºÐ°Ñ":
            if type_name == "Ð¡Ð¸Ñ‚ÑƒÐ°Ñ‚Ð¸Ð²Ð½Ð°Ñ Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ":
                text = "ðŸŒ¤ ÐÐ¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ð°Ñ Ñ€ÐµÐ°ÐºÑ†Ð¸Ñ. Ð”Ð»Ñ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð°Ð½Ð¸Ñ Ð±Ð°Ð»Ð°Ð½ÑÐ°: Ð¿Ñ€Ð°ÐºÑ‚Ð¸ÐºÑƒÐ¹Ñ‚Ðµ Ð¾ÑÐ¾Ð·Ð½Ð°Ð½Ð½Ð¾ÑÑ‚ÑŒ."
            else:
                text = (
                    "ðŸ”… Ð¡ÐºÐ»Ð¾Ð½Ð½Ð¾ÑÑ‚ÑŒ Ð¸Ð·Ð±ÐµÐ³Ð°Ñ‚ÑŒ ÑÐ»Ð¾Ð¶Ð½Ñ‹Ñ… ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ð¸Ð¹. "
                    "Ð¡Ð¾Ð²ÐµÑ‚: Ð¿Ð¾ÑÑ‚ÐµÐ¿ÐµÐ½Ð½Ð¾ Ñ€Ð°ÑÑˆÐ¸Ñ€ÑÐ¹Ñ‚Ðµ Ð·Ð¾Ð½Ñƒ ÐºÐ¾Ð¼Ñ„Ð¾Ñ€Ñ‚Ð°."
                )
                
        elif level == "ÑƒÐ¼ÐµÑ€ÐµÐ½Ð½Ð°Ñ":
            text = (  # Ð¾Ð±Ñ‰Ð¸Ð¹ ÑÐ¾Ð²ÐµÑ‚
                "âœ… ÐŸÐ¾Ð»ÐµÐ·Ð½Ñ‹Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸. "
                "Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ: Ñ€ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ñ‹Ð¹ ÑÐ°Ð¼Ð¾Ð°Ð½Ð°Ð»Ð¸Ð·, Ð±Ð°Ð»Ð°Ð½Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð¸ Ð¾Ñ‚Ð´Ñ‹Ñ…Ð°."
            )
            
        else:  # Ð²Ñ‹ÑÐ¾ÐºÐ°Ñ
            if type_name == "Ð¡Ð¸Ñ‚ÑƒÐ°Ñ‚Ð¸Ð²Ð½Ð°Ñ Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ":
                text = (
                    "ðŸš¨ ÐžÑÑ‚Ñ€Ñ‹Ð¹ ÑÑ‚Ñ€ÐµÑÑ. Ð¡Ñ€Ð¾Ñ‡Ð½Ñ‹Ðµ Ð¼ÐµÑ€Ñ‹: Ð´Ñ‹Ñ…Ð°Ð½Ð¸Ðµ 4-7-8, "
                    "Ñ„Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ, Ñ€Ð°Ð·Ð³Ð¾Ð²Ð¾Ñ€ Ñ Ð±Ð»Ð¸Ð·ÐºÐ¸Ð¼Ð¸."
                )
            else:
                text = (
                    "ðŸ”¥ Ð¥Ñ€Ð¾Ð½Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ñ‚Ñ€ÐµÐ²Ð¾Ð³Ð°. Ð”Ð¾Ð»Ð³Ð¾ÑÑ€Ð¾Ñ‡Ð½Ð¾: ÐšÐŸÐ¢-Ñ‚ÐµÑ…Ð½Ð¸ÐºÐ¸, "
                    "Ñ€Ð°Ð±Ð¾Ñ‚Ð° Ñ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°Ð¼Ð¸, ÐºÐ¾Ð½ÑÑƒÐ»ÑŒÑ‚Ð°Ñ†Ð¸Ñ ÑÐ¿ÐµÑ†Ð¸Ð°Ð»Ð¸ÑÑ‚Ð°."
                )
                
        return f"{type_name}: {score} ({level})\n{text}\n"

    result_text = (
        "ðŸ” Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹:\n\n"
        f"{get_description(st_score, 'Ð¡Ð¸Ñ‚ÑƒÐ°Ñ‚Ð¸Ð²Ð½Ð°Ñ Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ')}\n"
        f"{get_description(lt_score, 'Ð›Ð¸Ñ‡Ð½Ð¾ÑÑ‚Ð½Ð°Ñ Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ')}\n"
        "ðŸ“Œ ÐŸÑ€Ð¸Ð¼ÐµÑ‡Ð°Ð½Ð¸Ðµ:\n"
        "- Ð¡Ð¸Ñ‚ÑƒÐ°Ñ‚Ð¸Ð²Ð½Ð°Ñ Ñ‚Ñ€ÐµÐ²Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ: Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ, Ð·Ð°Ð²Ð¸ÑÐ¸Ñ‚ Ð¾Ñ‚ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð°\n"
        "- Ð›Ð¸Ñ‡Ð½Ð¾ÑÑ‚Ð½Ð°Ñ: ÑƒÑÑ‚Ð¾Ð¹Ñ‡Ð¸Ð²Ð°Ñ Ñ‡ÐµÑ€Ñ‚Ð°, Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ð¾Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹"
    )
    
    await update.effective_chat.send_message(text=result_text)

nest_asyncio.apply()
    
# Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹
async def send_notification(user_id, context):
    message = (
        "âœ¨ Ð’Ñ€ÐµÐ¼Ñ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ Ð¿ÐµÑ€ÐµÑ€Ñ‹Ð²! âœ¨\n\n"
        "ðŸ˜Œ Ð Ð°ÑÑÐ»Ð°Ð±ÑŒÑÑ Ð¸ ÑƒÐ´ÐµÐ»Ð¸ Ð¼Ð¸Ð½ÑƒÑ‚ÐºÑƒ Ð´Ñ‹Ñ…Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¼Ñƒ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸ÑŽ.\n"
        "ðŸŒ¿ Ð­Ñ‚Ð¾ Ð¿Ð¾Ð¼Ð¾Ð¶ÐµÑ‚ ÑÐ½Ð¸Ð·Ð¸Ñ‚ÑŒ ÑÑ‚Ñ€ÐµÑÑ Ð¸ ÑƒÐ»ÑƒÑ‡ÑˆÐ¸Ñ‚ÑŒ ÐºÐ¾Ð½Ñ†ÐµÐ½Ñ‚Ñ€Ð°Ñ†Ð¸ÑŽ.\n\n"
        "ðŸ’™ ÐÐ°Ð¶Ð¼Ð¸ ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð½Ð¸Ð¶Ðµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ â¬‡ï¸"
    )

    keyboard = InlineKeyboardMarkup(
        [[InlineKeyboardButton("â–¶ï¸ ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ð´Ñ‹Ñ…Ð°Ð½Ð¸Ðµ", callback_data="start_breathing")]]
    )

    try:
        await context.bot.send_message(chat_id=user_id, text=message, reply_markup=keyboard)
        # print(f"âœ… ÐÐ°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ {user_id}")
    except Exception as e:
        print(f"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ {user_id}: {e}")

# Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡Ð¸ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð² Ð² send_notification
def notification_wrapper(user_id, context):
    async def wrapper():
        await send_notification(user_id, context)
    return wrapper

# Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹
async def settings_menu(update: Update, context: CallbackContext):
    buttons = [
        [InlineKeyboardButton("ðŸ”” ÐšÐ°Ð¶Ð´Ñ‹Ðµ 2 Ñ‡Ð°ÑÐ°", callback_data="every_2_hours")],
        [InlineKeyboardButton("ðŸŒž Ð£Ñ‚Ñ€Ð¾Ð¼ Ð¸ Ð²ÐµÑ‡ÐµÑ€Ð¾Ð¼", callback_data="morning_evening")],
        [InlineKeyboardButton("âŒ ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ", callback_data="disable_notifications")]
    ]
    
    reply_markup = InlineKeyboardMarkup(buttons)
    await update.message.reply_text(
        "ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ñ Ð¾ Ð·Ð°Ð±Ð¾Ñ‚Ðµ Ð¾ ÑÐµÐ±Ðµ! ðŸŒ¸\nÐ’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ‡Ð°ÑÑ‚Ð¾Ñ‚Ñƒ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹: ðŸ•’",
        reply_markup=reply_markup
    )

# Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð²Ñ‹Ð±Ð¾Ñ€Ð° ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹
async def handle_notification_choice(update: Update, context: CallbackContext):
    query = update.callback_query
    user_id = query.from_user.id
    choice = query.data

    if scheduler.get_job(str(user_id)):
        scheduler.remove_job(str(user_id))
    if scheduler.get_job(f"{user_id}_morning"):
        scheduler.remove_job(f"{user_id}_morning")
    if scheduler.get_job(f"{user_id}_evening"):
        scheduler.remove_job(f"{user_id}_evening")

    if choice == "every_2_hours":
        scheduler.add_job(notification_wrapper(user_id, context), "interval", hours=2, name=str(user_id))
        user_notifications[user_id] = "ÐºÐ°Ð¶Ð´Ñ‹Ðµ 2 Ñ‡Ð°ÑÐ°"
        await query.answer("âœ… Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ñ‹ (ÐºÐ°Ð¶Ð´Ñ‹Ðµ 2 Ñ‡Ð°ÑÐ°).")

    elif choice == "morning_evening":
        scheduler.add_job(notification_wrapper(user_id, context), "cron", hour=10, minute=0, name=f"{user_id}_morning")
        scheduler.add_job(notification_wrapper(user_id, context), "cron", hour=16, minute=0, name=f"{user_id}_evening")
        user_notifications[user_id] = "ÑƒÑ‚Ñ€Ð¾Ð¼ Ð¸ Ð²ÐµÑ‡ÐµÑ€Ð¾Ð¼"
        await query.answer("âœ… Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ñ‹ (ÑƒÑ‚Ñ€Ð¾Ð¼ Ð¸ Ð²ÐµÑ‡ÐµÑ€Ð¾Ð¼).")

    elif choice == "disable_notifications":
        user_notifications.pop(user_id, None)
        await query.answer("âŒ Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ñ‹.")

async def main():
    scheduler.start()
    
    app = Application.builder().token(TOKEN).build()

    app.add_handler(CommandHandler("start", start))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_buttons)) 
    
    # Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð´Ð»Ñ Ð´Ñ‹Ñ…Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð³Ð¾ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ñ
    app.add_handler(CallbackQueryHandler(guided_breathing, pattern="start_breathing"))
    
    # Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸ Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð°
    app.add_handler(CallbackQueryHandler(handle_test_answer, pattern="start_test|prev_question|^[0-3]$"))
    
    # Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸ Ð´Ð»Ñ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ð¹ Ð¿Ð¾ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸ÑŽ
    app.add_handler(CallbackQueryHandler(handle_emotion, pattern="^emotion_"))
    
    # Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸ Ð´Ð»Ñ Ð¼ÑƒÐ·Ñ‹ÐºÐ¸
    app.add_handler(CommandHandler("audio", audio_menu))
    app.add_handler(CallbackQueryHandler(play_audio, pattern="^audio_"))
    
    
    # Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸ Ð´Ð»Ñ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹
    
    app.add_handler(CommandHandler("settings", settings_menu))
    app.add_handler(CallbackQueryHandler(handle_notification_choice))
    

    await app.run_polling()
    
if __name__ == "__main__":
    loop = asyncio.get_event_loop()
    loop.run_until_complete(main())  
